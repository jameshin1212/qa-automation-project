version: '3.8'

services:
  # Standalone Allure Report Server
  allure-standalone:
    image: allure-framework/allure-docker-service:latest
    container_name: whatap-allure-standalone
    ports:
      - "5555:5050"  # 포트 충돌 방지를 위해 5555 사용
    volumes:
      - ./allure-results:/app/allure-results
      - ./allure-report:/app/reports
    environment:
      ALLURE_DOCKER_PUBLIC_API_URL: "http://localhost:5555"
      GENERATE_REPORT_ON_RESULTS: "true"
      CHECK_RESULTS_EVERY_SECONDS: 5
      KEEP_HISTORY: "true"
    command: >
      sh -c "
        echo 'Starting Allure Docker Service...' &&
        cd /app &&
        allure-docker --host 0.0.0.0 --port 5050"
    networks:
      - qa-network

networks:
  qa-network:
    driver: bridge
    name: whatap-qa-network